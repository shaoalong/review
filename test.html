<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <form id="registerForm">
        请输入用户名：<input type="text" name="userName">
        请输入密码：<input type="text" name="password">
        请输入电话号码：<input type="text" name="phoneNumber">
        <button>提交</button>
    </form>
    <script>
        // var StatusFactory = function(params) {
        //     var Status = function() {}
        //     Status.prototype.buttonHandler = function() {
        //         throw new Error('子类必须重写该方法')
        //     }
        //     var F = function(Light) {
        //         this.light = Light
        //     }
        //     for (var i in params) {
        //         F.prototype[i] = params[i]
        //     }
        //     return F
        // }
        // var OffLightStatus = StatusFactory({buttonHandler: function off() {
        //     console.log('关灯状态')
        //     this.light.setStatus(this.light.onLightStatus)
        //     this.light.button.innerHTML="开灯"
        // }})
        // var OnLightStatus = StatusFactory({buttonHandler: function on() {
        //     console.log('开灯状态')
        //     this.light.setStatus(this.light.offLightStatus)
        //     this.light.button.innerHTML="关灯"
        // }})

        // var Light = function() {
        //     this.offLightStatus = new OffLightStatus(this)
        //     this.onLightStatus = new OnLightStatus(this)
        //     this.status = this.onLightStatus;
        //     this.init()
        // }
        // Light.prototype.init = function() {
        //     this.button = document.createElement('button')
        //     this.button.innerHTML = '开灯'
        //     document.body.appendChild(this.button)
        //     var _this = this
        //     this.button.onclick = function() {
        //         _this.status.buttonHandler()
        //     }
        // }
        // Light.prototype.setStatus = function(status) {
        //     this.status = status
        // }
        // var light = new Light()

        // const MyImage = function(src) {
        //     this.imgNode = document.createElement('img')
        //     this.imgNode.src = src
        //     this.imgNode.setAttribute('width', '200px')
        //     console.log(this.imgNode.setAttribute)
        //     document.body.appendChild(this.imgNode)
        // }
        // MyImage.prototype.setSrc = function(src) {
        //     this.imgNode.src = src
        // }

        // const proxyImage = function(src) {
        //     this.img = new MyImage()
        //     this.image = new Image
        //     this.setSrc(src)
        //     const _this = this
        //     this.image.onload = function() {
        //         _this.img.setSrc(this.src)
        //     }
        // }
        // proxyImage.prototype.setSrc = function(src) {
        //     this.img.setSrc('/loading.gif')
        //     this.image.src = src
        // }

        // new proxyImage('/timg.jpg')


        const strategies = {
            isNonEmpty(value, errorMsg) {
                if (!value) {
                    return errorMsg
                }
            },
            minLength(value, length, errorMsg) {
                if (value.length < length) {
                    return errorMsg
                }
            },
            isMobile(value, errorMsg) {
                if (!/^1[3|5|5][0-9]{9}$/.test(value)) {
                    return errorMsg
                }
            }
        }

        class Validator {
            constructor() {
                this.cache = []
            }
            validate() {
                for (let validatorFunc of this.cache) {
                    const msg = validatorFunc()
                    if (msg) {
                        return msg
                    }
                }
            }
            add(dom, rules) {
                const self = this
                for (let rule of rules) {
                    (function (rule) {
                        self.cache.push(function () {
                            const strategyArr = rule.strategy.split(';')
                            const errorMsg = rule.errorMsg
                            const strategy = strategyArr.shift()
                            strategyArr.unshift(dom.value)
                            strategyArr.push(errorMsg)
                            return strategies[strategy].apply(dom, strategyArr)
                        })
                    })(rule)
                }
            }
        }

        const validator = new Validator()
        const registerForm = document.getElementById('registerForm');
        validator.add(registerForm.userName, [{
                strategy: 'isNonEmpty',
                errorMsg: '用户名不能为空',
            },
            {
                strategy: 'minLength:6',
                errorMsg: '用户名长度不能少于6位',
            },
        ]);
        validator.add(registerForm.password, [{
            strategy: 'minLength:6',
            errorMsg: '密码长度不能少于6位',
        }, ]);
        validator.add(registerForm.phoneNumber, [{
            strategy: 'isMobile',
            errorMsg: '手机号码格式不正确',
        }, ]);
        validator.validate()

        registerForm.onsubmit = function(){
            var errorMsg = validator.validate();
            if (errorMsg) {
                alert(errorMsg);
                return false;
            };
        };
    </script>
</body>

</html>